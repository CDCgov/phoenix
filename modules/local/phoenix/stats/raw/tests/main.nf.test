nextflow_process {

    name "Test Process GET_RAW_STATS"
    script "../main.nf"
    process "GET_RAW_STATS"

    test("get raw stats") {

        when {
            process {
                """
                // define inputs of the process
                input[0] =
                    [
                    [id: 'test'],
                    [file(params.modules_testdata_base_path + '/genomics/bacterial/fastqs/test_R1_001.fastq.gz'),
                    file(params.modules_testdata_base_path + '/genomics/bacterial/fastqs/test_R2_001.fastq.gz')],
                    file(params.modules_testdata_base_path + '/genomics/bacterial/reports/test1_summary.txt'),
                    ["PASSED: File test_R1 is not corrupt.", "PASSED: File test_R2 is not corrupt."]
                    ]
                input[1] = false
                """
            }
        }

        then {
            assert process.success
            assert snapshot(
                process.out.combined_raw_stats,
                process.out.outcome_to_edit,
                process.out.outcome
            ).match()
            assert process.out.raw_stats[0][1].size() > 0
        }

    }

    test("get raw stats -stub") {

        options '-stub'

        when {
            process {
                """
                input[0] =
                    [
                    [id: 'test'],
                    [file(params.modules_testdata_base_path + '/genomics/bacterial/fastqs/test_R1_001.fastq.gz'),
                    file(params.modules_testdata_base_path + '/genomics/bacterial/fastqs/test_R2_001.fastq.gz')],
                    file(params.modules_testdata_base_path + '/genomics/bacterial/reports/test1_summary.txt'),
                    ["PASSED: File test_R1 is not corrupt.", "PASSED: File test_R2 is not corrupt."]
                    ]
                input[1] = false
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }
    }
}
